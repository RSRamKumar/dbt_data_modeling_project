version: 2

models:
  - name: customer_orders_summary
    description: >
      Gold mart model. One row per customer containing their first order date,
      most recent order date, lifetime sales metrics, and active span.
    columns:
      - name: customer_sk
        description: Surrogate key for the customer (joins to dim_customers).
        tests:
          - not_null
          - unique
          - relationships:
              to: ref('dim_customers')
              field: customer_sk

      - name: customer_id
        description: Natural business key for the customer.
        tests:
          - not_null

      - name: customer_name
        description: Full name of the customer.

      - name: first_order_date
        description: The date of the customer's very first order.

      - name: recent_order_date
        description: The date of the customer's most recent order.
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: "<= current_date"

      - name: lifetime_orders_count
        description: Total number of distinct orders placed by the customer.
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"

      - name: lifetime_total_amount
        description: Lifetime sum of order amounts for the customer.
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"

      - name: customer_activespan_days
        description: >
          Number of days between the customer's first and most recent order.
          Represents how long the customer has been active.
        tests:
          - dbt_utils.expression_is_true:
              expression: ">= 0"
       
      - name: load_timestamp
        description: Timestamp when the record was last loaded into the warehouse.


  - name: sales_daily_summary
    description: >
            Gold mart model. One row per store per order date, containing sales and KPI metrics
            (e.g. total sales, total items, orders, unique customers, avg order value).
    columns:
        - name: date_sk
          description: Surrogate key referencing the order date.
          tests:
            - not_null
            - relationships:
                to: ref('dim_dates')
                field: date_sk

        - name: store_sk
          description: Surrogate key for the store.
          tests:
            - not_null
            - relationships:
                to: ref('dim_stores')
                field: store_sk

        - name: total_sales_amount
          description: Total sales amount (in euros) for that store and date.
          tests:
            - not_null
            - dbt_utils.expression_is_true:
                expression: ">= 0"

        - name: total_items_sold
          description: Total number of items sold for that store and date.
          tests:
            - not_null
            - dbt_utils.expression_is_true:
                    expression: ">= 0"

        - name: total_orders_count
          description: Total number of distinct orders for that store and date.
          tests:
            - not_null
            - dbt_utils.expression_is_true:
                expression: ">= 0"

        - name: unique_customers_count
          description: Number of unique customers who placed orders at that store and date.
          tests:
            - not_null
            - dbt_utils.expression_is_true:
                    expression: ">= 0"

        - name: avg_order_value
          description: Average order value (sales amount / orders) for that store and date.

        - name: avg_items_per_order
          description: Average number of items per order for that store and date.

        - name: load_timestamp
          description: Timestamp when the record was last loaded into the warehouse.  